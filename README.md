# XiMultiLogin

## è¯­è¨€ / Language

- [ä¸­æ–‡ (ç®€ä½“)](#ä¸­æ–‡)
- [English](#english)

## ä¸­æ–‡

XiMultiLogin æ˜¯ä¸€ä¸ªä¸º Minecraft Bukkit/Spigot/Paper æœåŠ¡å™¨è®¾è®¡çš„å¤šè®¤è¯æ–¹å¼æ”¯æŒæ’ä»¶ï¼Œæ—¨åœ¨è§£å†³ MultiLogin å–æ¶ˆå¯¹ Bukkit å¹³å°æ”¯æŒåï¼Œç¤¾åŒºç¼ºä¹æ›¿ä»£æ–¹æ¡ˆçš„é—®é¢˜ã€‚

## èƒŒæ™¯

### ä¸ºä»€ä¹ˆéœ€è¦ XiMultiLoginï¼Ÿ

MultiLogin æ˜¯ä¸€ä¸ªä¼˜ç§€çš„ Minecraft å¤šè®¤è¯æ’ä»¶ï¼Œä½†ç”±äºå¼€å‘å›¢é˜Ÿå†³å®šåœæ­¢å¯¹ Bukkit å¹³å°çš„æ”¯æŒï¼Œå¤§é‡ä½¿ç”¨ Bukkit/Spigot/Paper çš„æœåŠ¡å™¨å¤±å»äº†ä½¿ç”¨ MultiLogin çš„æœºä¼šã€‚XiMultiLogin åº”è¿è€Œç”Ÿï¼Œæ—¨åœ¨å¡«è¡¥è¿™ä¸€ç©ºç™½ã€‚

### è®¾è®¡ç›®æ ‡

- **é«˜æ€§èƒ½**ï¼šä¼˜åŒ–çš„è®¤è¯æµç¨‹ï¼Œæœ€å°åŒ–å¯¹æœåŠ¡å™¨æ€§èƒ½çš„å½±å“
- **é«˜å¯é…ç½®æ€§**ï¼šçµæ´»çš„é…ç½®ç³»ç»Ÿï¼Œæ»¡è¶³ä¸åŒæœåŠ¡å™¨çš„éœ€æ±‚
- **å¤šè®¤è¯æ”¯æŒ**ï¼šæ”¯æŒ Mojang å®˜æ–¹è®¤è¯å’Œå¤šç§ Yggdrasil åè®®è®¤è¯
- **å®‰å…¨å¯é **ï¼šä¸¥æ ¼çš„èº«ä»½é”å®šæœºåˆ¶ï¼Œé˜²æ­¢èº«ä»½å†’ç”¨
- **æ˜“äºä½¿ç”¨**ï¼šç®€æ´çš„é…ç½®å’Œå‘½ä»¤ç³»ç»Ÿï¼Œé™ä½ä½¿ç”¨é—¨æ§›

## æ ¸å¿ƒç‰¹æ€§

### å¤šè®¤è¯æ–¹å¼æ”¯æŒ
- **Mojang å®˜æ–¹è®¤è¯**ï¼šæ ‡å‡† Minecraft è´¦æˆ·ç™»å½•
- **Yggdrasil åè®®è®¤è¯**ï¼šæ”¯æŒ LittleSkin ç­‰ç¬¬ä¸‰æ–¹çš®è‚¤ç«™
- **å¯æ‰©å±•æ¶æ„**ï¼šæ˜“äºæ·»åŠ æ–°çš„è®¤è¯æä¾›è€…

### å®‰å…¨ç‰¹æ€§
- **èº«ä»½é”å®šæœºåˆ¶**ï¼šé˜²æ­¢"åŒåä¸åŒ UUID"çš„å®‰å…¨é—®é¢˜
- **ä¸¥æ ¼è®¤è¯æ¨¡å¼**ï¼šä¸€æ—¦ç©å®¶ä½¿ç”¨æŸç§è®¤è¯æ–¹å¼ç™»å½•ï¼Œåç»­ç™»å½•å¿…é¡»ä½¿ç”¨ç›¸åŒæ–¹å¼
- **UUID æ¥ç®¡ç³»ç»Ÿ**ï¼šç¡®ä¿ç©å®¶åœ¨ä¸åŒè®¤è¯æ–¹å¼é—´åˆ‡æ¢æ—¶ä¿æŒ UUID ä¸€è‡´æ€§
- **æ•°æ®åº“æŒä¹…åŒ–**ï¼šé‡å¯æœåŠ¡å™¨åç©å®¶èº«ä»½ä¿¡æ¯ä¸ä¼šä¸¢å¤±

### ç®¡ç†åŠŸèƒ½
- **å‘½ä»¤ç³»ç»Ÿ**ï¼šå®Œæ•´çš„ç®¡ç†å‘½ä»¤ï¼Œæ”¯æŒè®¾ç½®å’ŒæŸ¥è¯¢ç©å®¶è®¤è¯æ–¹å¼
- **PAPI å˜é‡æ”¯æŒ**ï¼šä¸ PlaceholderAPI é›†æˆï¼Œæ˜¾ç¤ºç©å®¶è®¤è¯çŠ¶æ€
- **æ¶ˆæ¯é…ç½®ç³»ç»Ÿ**ï¼šå¯è‡ªå®šä¹‰æ‰€æœ‰æç¤ºæ¶ˆæ¯
- **ç›—ç‰ˆç©å®¶æ”¯æŒ**ï¼šå¯é€‰æ˜¯å¦å…è®¸æœªé€šè¿‡è®¤è¯çš„ç©å®¶åŠ å…¥

### æŠ€æœ¯ç‰¹æ€§
- **å¤šç‰ˆæœ¬å…¼å®¹**ï¼šæ”¯æŒ Minecraft 1.16.5 - 1.21+ï¼Œç‰¹åˆ«ä¼˜åŒ– 1.20.2+ï¼ˆæš‚æœªæµ‹è¯• ç¨³å®šæ€§å¾…å®šï¼‰
- **åŠ¨æ€ä»£ç†æœºåˆ¶**ï¼šè§£å†³ ClassLoader éš”ç¦»é—®é¢˜
- **Record é‡æ„æ”¯æŒ**ï¼šå¤„ç† Java Record çš„ä¸å¯å˜æ€§
- **åå°„å·¥å…·**ï¼šè·¨ç‰ˆæœ¬çš„åå°„æ“ä½œï¼Œé€‚é…ä¸åŒ NMS ç±»ç»“æ„
- **æ•°æ®åº“æ”¯æŒ**ï¼šSQLiteï¼ˆé»˜è®¤ï¼‰å’Œ MySQLï¼Œä½¿ç”¨ HikariCP è¿æ¥æ± 

## å·¥ä½œåŸç†

### æŠ€æœ¯æ¶æ„

XiMultiLogin é€šè¿‡ä»¥ä¸‹å‡ ä¸ªæ ¸å¿ƒç»„ä»¶å®ç°å¤šè®¤è¯æ”¯æŒï¼š

#### 1. æ³¨å…¥æœºåˆ¶ï¼ˆXiInjectorï¼‰

æ’ä»¶å¯åŠ¨æ—¶ï¼Œé€šè¿‡åå°„å°†è‡ªå®šä¹‰çš„ `XiSessionService` æ³¨å…¥åˆ° Minecraft æœåŠ¡å™¨çš„éªŒè¯æµç¨‹ä¸­ï¼š

```
æœåŠ¡å™¨å¯åŠ¨ â†’ XiInjector åˆå§‹åŒ– â†’ æ³¨å…¥ XiSessionService â†’ æ›¿æ¢é»˜è®¤ SessionService
```

**æŠ€æœ¯æŒ‘æˆ˜ä¸è§£å†³æ–¹æ¡ˆ**ï¼š

- **ClassLoader éš”ç¦»**ï¼šæ’ä»¶å’ŒæœåŠ¡å™¨çš„ç±»åŠ è½½å™¨ä¸åŒï¼Œç›´æ¥æ“ä½œä¼šå¯¼è‡´ç±»å‹ä¸åŒ¹é…
  - è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨åŠ¨æ€ä»£ç†åˆ›å»ºè·¨ ClassLoader çš„æ¡¥æ¥å¯¹è±¡

- **Java Record ä¸å¯å˜æ€§**ï¼š1.20.2+ ç‰ˆæœ¬ä½¿ç”¨ Record å­˜å‚¨é…ç½®ï¼Œæ— æ³•ç›´æ¥ä¿®æ”¹
  - è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨åå°„è¯»å–å­—æ®µå€¼ï¼Œé‡å»º Record å¯¹è±¡

- **æ–¹æ³•ç­¾åå˜åŒ–**ï¼šä¸åŒç‰ˆæœ¬çš„æ–¹æ³•ç­¾åå¯èƒ½ä¸åŒ
  - è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨å®½æ¾åå°„åŒ¹é…å’Œæ™ºèƒ½å‚æ•°é€‚é…

#### 2. è®¤è¯æµç¨‹ï¼ˆXiSessionServiceï¼‰

å½“ç©å®¶å°è¯•åŠ å…¥æœåŠ¡å™¨æ—¶ï¼Œè®¤è¯æµç¨‹å¦‚ä¸‹ï¼š

```
ç©å®¶ç™»å½• â†’ hasJoinedServer è°ƒç”¨ â†’ æ£€æŸ¥æ•°æ®åº“ â†’ 
  â”œâ”€ æœ‰è®°å½• â†’ ä»…ä½¿ç”¨æŒ‡å®šè®¤è¯æ–¹å¼ â†’ æˆåŠŸ/å¤±è´¥
  â””â”€ æ— è®°å½• â†’ éå†æ‰€æœ‰è®¤è¯æ–¹å¼ â†’ æˆåŠŸåˆ™è®°å½• â†’ å¤±è´¥åˆ™æ‹’ç»
```

**ä¸¥æ ¼è®¤è¯æ¨¡å¼**ï¼š

- å¦‚æœæ•°æ®åº“ä¸­å­˜åœ¨ç©å®¶çš„è®¤è¯è®°å½•ï¼Œåªä½¿ç”¨è¯¥è®°å½•æŒ‡å®šçš„è®¤è¯æ–¹å¼
- å¦‚æœè®¤è¯å¤±è´¥ï¼Œç›´æ¥æ‹’ç»ç™»å½•ï¼Œä¸å°è¯•å…¶ä»–æ–¹å¼
- è¿™é˜²æ­¢äº†èº«ä»½å†’ç”¨ï¼šå³ä½¿æœ‰äººçŸ¥é“å…¶ä»–è®¤è¯æ–¹å¼çš„å¯†ç ï¼Œä¹Ÿæ— æ³•ç™»å½•

**UUID æ¥ç®¡ç³»ç»Ÿ**ï¼š

- å½“ç©å®¶ä½¿ç”¨æ–°è®¤è¯æ–¹å¼ç™»å½•æ—¶ï¼Œç³»ç»Ÿä¼šæ£€æŸ¥æ˜¯å¦å·²æœ‰è¯¥ç©å®¶çš„ UUID è®°å½•
- å¦‚æœæœ‰ï¼Œä½¿ç”¨å†å² UUIDï¼Œç¡®ä¿ç©å®¶èº«ä»½ä¸€è‡´æ€§
- è¿™è§£å†³äº†åˆ‡æ¢è®¤è¯æ–¹å¼å UUID å˜åŒ–å¯¼è‡´çš„æ•°æ®ä¸¢å¤±é—®é¢˜

#### 3. è®¤è¯æä¾›è€…ï¼ˆAuthProviderï¼‰

æ’ä»¶ä½¿ç”¨æä¾›è€…æ¨¡å¼æ”¯æŒå¤šç§è®¤è¯æ–¹å¼ï¼š

- **MojangAuthProvider**ï¼šè°ƒç”¨ Mojang å®˜æ–¹è®¤è¯ API
- **YggdrasilAuthProvider**ï¼šè°ƒç”¨ Yggdrasil åè®® APIï¼ˆæ”¯æŒ LittleSkinã€HairuoSKY ç­‰ï¼‰

æ¯ä¸ªæä¾›è€…éƒ½å®ç° `authenticate()` æ–¹æ³•ï¼Œè¿”å›ç©å®¶çš„ GameProfile æˆ– nullã€‚

#### 4. èº«ä»½å®ˆæŠ¤ï¼ˆIdentityGuardï¼‰

`IdentityGuard` è´Ÿè´£ç®¡ç†ç©å®¶çš„èº«ä»½ä¿¡æ¯ï¼š

- å­˜å‚¨ç©å®¶åç§°ã€UUID å’Œè®¤è¯æ–¹å¼çš„æ˜ å°„å…³ç³»
- é˜²æ­¢åŒåä¸åŒ UUID çš„å®‰å…¨é—®é¢˜
- æä¾› UUID æ¥ç®¡åŠŸèƒ½ï¼Œç¡®ä¿èº«ä»½ä¸€è‡´æ€§

#### 5. æ•°æ®åº“ç®¡ç†ï¼ˆDatabaseManagerï¼‰

æ”¯æŒä¸¤ç§æ•°æ®åº“ï¼š

- **SQLite**ï¼šé»˜è®¤ï¼Œè‡ªåŠ¨åˆ›å»º `ximultilogin.db` æ–‡ä»¶ï¼Œé€‚åˆå°å‹æœåŠ¡å™¨
- **MySQL**ï¼šéœ€è¦æ‰‹åŠ¨é…ç½®ï¼Œé€‚åˆå¤§å‹æœåŠ¡å™¨ï¼Œæä¾›æ›´å¥½çš„å¹¶å‘æ€§èƒ½

ä½¿ç”¨ HikariCP è¿æ¥æ± ä¼˜åŒ–æ•°æ®åº“è¿æ¥ã€‚

### æ•°æ®æµç¨‹å›¾

```
ç©å®¶ç™»å½•è¯·æ±‚
    â†“
XiSessionService.hasJoinedServer()
    â†“
æŸ¥è¯¢æ•°æ®åº“
    â†“
æœ‰è®°å½•ï¼Ÿ
    â”œâ”€ æ˜¯ â†’ ä»…ä½¿ç”¨æŒ‡å®šè®¤è¯æ–¹å¼
    â”‚        â†“
    â”‚     è®¤è¯æˆåŠŸï¼Ÿ
    â”‚        â”œâ”€ æ˜¯ â†’ UUID æ¥ç®¡ â†’ è¿”å› GameProfile
    â”‚        â””â”€ å¦ â†’ æ‹’ç»ç™»å½•
    â”‚
    â””â”€ å¦ â†’ éå†æ‰€æœ‰è®¤è¯æ–¹å¼
             â†“
          è®¤è¯æˆåŠŸï¼Ÿ
             â”œâ”€ æ˜¯ â†’ è®°å½•è®¤è¯æ–¹å¼å’Œ UUID â†’ è¿”å› GameProfile
             â””â”€ å¦ â†’ å…è®¸ç›—ç‰ˆï¼Ÿ
                     â”œâ”€ æ˜¯ â†’ åˆ›å»ºä¸´æ—¶èº«ä»½ â†’ è¿”å› GameProfile
                     â””â”€ å¦ â†’ æ‹’ç»ç™»å½•
```

## å®‰è£…æ–¹æ³•

### ç³»ç»Ÿè¦æ±‚

- **Java ç‰ˆæœ¬**ï¼šJava 8 æˆ–æ›´é«˜ç‰ˆæœ¬
- **æœåŠ¡å™¨ç±»å‹**ï¼šBukkit/Spigot/Paper 1.16.5 - 1.21+
- **ä¾èµ–æ’ä»¶**ï¼šPlaceholderAPIï¼ˆå¯é€‰ï¼Œç”¨äº PAPI å˜é‡æ”¯æŒï¼‰

### å®‰è£…æ­¥éª¤

1. **ä¸‹è½½æ’ä»¶**
   - ä» GitHub Releases ä¸‹è½½æœ€æ–°ç‰ˆæœ¬çš„ `XiMultiLogin-x.x.jar`
   - æˆ–è‡ªè¡Œç¼–è¯‘é¡¹ç›®ï¼ˆè§å¼€å‘æŒ‡å—ï¼‰

2. **å®‰è£…åˆ°æœåŠ¡å™¨**
   - å°† JAR æ–‡ä»¶æ”¾å…¥æœåŠ¡å™¨çš„ `plugins` ç›®å½•
   - é‡å¯æœåŠ¡å™¨

3. **é¦–æ¬¡å¯åŠ¨**
   - æ’ä»¶ä¼šè‡ªåŠ¨åˆ›å»ºé…ç½®æ–‡ä»¶å’Œæ•°æ®åº“
   - é»˜è®¤ä½¿ç”¨ SQLite æ•°æ®åº“ï¼Œæ— éœ€é¢å¤–é…ç½®
   - æ£€æŸ¥æ§åˆ¶å°æ—¥å¿—ï¼Œç¡®ä¿æ’ä»¶æ­£å¸¸åŠ è½½

## é…ç½®è¯´æ˜

æ’ä»¶å¯åŠ¨åä¼šåœ¨ `plugins/XiMultiLogin` ç›®å½•ç”Ÿæˆä»¥ä¸‹æ–‡ä»¶ï¼š

- `config.yml`ï¼šä¸»é…ç½®æ–‡ä»¶
- `messages.yml`ï¼šæ¶ˆæ¯é…ç½®æ–‡ä»¶
- `ximultilogin.db`ï¼šSQLite æ•°æ®åº“æ–‡ä»¶ï¼ˆå¦‚æœä½¿ç”¨ SQLiteï¼‰

### ä¸»é…ç½®æ–‡ä»¶ï¼ˆconfig.ymlï¼‰

```yaml
# XiMultiLogin é…ç½®æ–‡ä»¶
# éªŒè¯é“¾é¡ºåºï¼šä»ä¸Šåˆ°ä¸‹å°è¯•
pipeline:
  # Mojang å®˜æ–¹è®¤è¯
  - type: MOJANG
    enabled: true
  
  # Yggdrasil åè®®è®¤è¯ï¼ˆLittleSkinï¼‰
  - type: YGGDRASIL
    name: "LittleSkin"
    api: "https://littleskin.cn/api/yggdrasil"
    enabled: true
  
  # Yggdrasil åè®®è®¤è¯ï¼ˆHairuoSKYï¼‰
  - type: YGGDRASIL
    name: "HairuoSKY"
    api: "https://skin.hairuosky.cn/api/yggdrasil"
    enabled: true

# æ•°æ®åº“é…ç½®
database:
  # æ•°æ®åº“ç±»å‹: SQLite (é»˜è®¤) æˆ– MySQL
  type: "SQLite"
  
  # MySQL é…ç½® (ä»…å½“ type ä¸º MySQL æ—¶ç”Ÿæ•ˆ)
  mysql:
    host: "localhost"
    port: 3306
    database: "ximultilogin"
    username: "root"
    password: "password"

# ç›—ç‰ˆç©å®¶è®¾ç½®
# æ˜¯å¦å…è®¸æœªé€šè¿‡ä»»ä½•è®¤è¯çš„ç©å®¶åŠ å…¥ï¼ˆé»˜è®¤ä¸º falseï¼‰
# ä¸å»ºè®®å¼€å¯ï¼Œå¦åˆ™å¯èƒ½å‡ºç°å®‰å…¨æ€§é—®é¢˜
allow_cracked: false
```

#### é…ç½®é¡¹è¯¦è§£

**éªŒè¯é“¾é…ç½®ï¼ˆpipelineï¼‰**

- `type`ï¼šè®¤è¯ç±»å‹ï¼Œæ”¯æŒ `MOJANG` æˆ– `YGGDRASIL`
- `enabled`ï¼šæ˜¯å¦å¯ç”¨è¯¥è®¤è¯æ–¹å¼
- `name`ï¼šè®¤è¯æä¾›è€…åç§°ï¼ˆä»… `YGGDRASIL` ç±»å‹éœ€è¦ï¼Œç”¨äºæ ‡è¯†ä¸åŒçš„ Yggdrasil æœåŠ¡å™¨ï¼‰
- `api`ï¼šYggdrasil API åœ°å€ï¼ˆä»… `YGGDRASIL` ç±»å‹éœ€è¦ï¼‰

**æ•°æ®åº“é…ç½®ï¼ˆdatabaseï¼‰**

- `type`ï¼šæ•°æ®åº“ç±»å‹ï¼Œå¯é€‰ `SQLite` æˆ– `MySQL`
- `mysql`ï¼šMySQL æ•°æ®åº“é…ç½®ï¼ˆä»…å½“ `type` ä¸º `MySQL` æ—¶ç”Ÿæ•ˆï¼‰
  - `host`ï¼šMySQL æœåŠ¡å™¨åœ°å€
  - `port`ï¼šMySQL ç«¯å£
  - `database`ï¼šæ•°æ®åº“åç§°
  - `username`ï¼šæ•°æ®åº“ç”¨æˆ·å
  - `password`ï¼šæ•°æ®åº“å¯†ç 

**ç›—ç‰ˆç©å®¶è®¾ç½®ï¼ˆallow_crackedï¼‰**

- `true`ï¼šå…è®¸æœªé€šè¿‡ä»»ä½•è®¤è¯çš„ç©å®¶åŠ å…¥ï¼ˆåˆ›å»ºä¸´æ—¶èº«ä»½ï¼‰
- `false`ï¼šæ‹’ç»æœªé€šè¿‡è®¤è¯çš„ç©å®¶åŠ å…¥ï¼ˆé»˜è®¤ï¼‰

### æ¶ˆæ¯é…ç½®æ–‡ä»¶ï¼ˆmessages.ymlï¼‰

```yaml
# XiMultiLogin æ¶ˆæ¯é…ç½®æ–‡ä»¶
# æ”¯æŒé¢œè‰²ä»£ç ï¼Œå¦‚ &c, &a ç­‰
# æ”¯æŒå˜é‡æ›¿æ¢ï¼Œå¦‚ {player}, {reason} ç­‰

login:
  success: "&aç™»å½•æˆåŠŸï¼æ¬¢è¿å›æ¥ï¼Œ{player}ï¼"
  failed: "&cç™»å½•å¤±è´¥ï¼š{reason}"
  name_taken: "&cç™»å½•å¤±è´¥ï¼šè¯¥æ˜µç§°å·²è¢«ä½¿ç”¨ï¼Œè¯·é€‰æ‹©å…¶ä»–æ˜µç§°ï¼"
  auth_changed: "&aè®¤è¯æ–¹å¼å·²å˜æ›´ä¸º {provider}ï¼"
  cracked: "&eç™»å½•æˆåŠŸï¼ˆç›—ç‰ˆæ¨¡å¼ï¼‰ï¼šæ¬¢è¿ï¼Œ{player}ï¼"

error:
  authentication: "&cè®¤è¯å¤±è´¥ï¼šæ— æ³•éªŒè¯æ‚¨çš„èº«ä»½ï¼"
  no_permission: "&cæƒé™ä¸è¶³ï¼šæ‚¨æ²¡æœ‰æ‰§è¡Œæ­¤æ“ä½œçš„æƒé™ï¼"
  invalid_args: "&cå‚æ•°é”™è¯¯ï¼šè¯·æ£€æŸ¥å‘½ä»¤å‚æ•°ï¼"
  player_not_found: "&cé”™è¯¯ï¼šç©å®¶ {player} æœªæ‰¾åˆ°ï¼"
  config_error: "&cé…ç½®é”™è¯¯ï¼š{reason}"
  database: "&cæ•°æ®åº“é”™è¯¯ï¼š{reason}"

command:
  success: "&aæ“ä½œæˆåŠŸï¼"
  set_auth: "&aæˆåŠŸè®¾ç½®ç©å®¶ {player} çš„è®¤è¯æ–¹å¼ä¸º {auth}ï¼"
  get_auth: "&aç©å®¶ {player} çš„å½“å‰è®¤è¯æ–¹å¼ï¼š{auth}"
  set_allow_cracked: "&aæˆåŠŸè®¾ç½®å…è®¸ç›—ç‰ˆç©å®¶åŠ å…¥ï¼š{value}"
  get_allow_cracked: "&aå½“å‰å…è®¸ç›—ç‰ˆç©å®¶åŠ å…¥çš„è®¾ç½®ï¼š{value}"
  reloaded: "&aé…ç½®å·²é‡æ–°åŠ è½½ï¼"
  messages_reloaded: "&aæ¶ˆæ¯é…ç½®å·²é‡æ–°åŠ è½½ï¼"

system:
  enabled: "&aXiMultiLogin æ’ä»¶å·²å¯ç”¨ï¼"
  disabled: "&cXiMultiLogin æ’ä»¶å·²ç¦ç”¨ï¼"
  messages_loaded: "&aæ¶ˆæ¯é…ç½®åŠ è½½æˆåŠŸï¼"
  messages_reload: "&aæ¶ˆæ¯é…ç½®å·²é‡è½½ï¼"

other:
  unknown_command: "&cæœªçŸ¥æŒ‡ä»¤ï¼šè¯·ä½¿ç”¨ /ximultilogin help æŸ¥çœ‹å¸®åŠ©ï¼"
  help: "&aä½¿ç”¨ /ximultilogin help æŸ¥çœ‹æŒ‡ä»¤å¸®åŠ©ï¼"
  help_menu:
    title: "&6===== XiMultiLogin æŒ‡ä»¤å¸®åŠ© ====="
    setauth: "&a/ximultilogin setauth <ç©å®¶å> <è®¤è¯ç±»å‹> - è®¾ç½®ç©å®¶çš„è®¤è¯æ–¹å¼"
    getauth: "&a/ximultilogin getauth <ç©å®¶å> - è·å–ç©å®¶çš„å½“å‰è®¤è¯æ–¹å¼"
    allowcracked: "&a/ximultilogin allowcracked <true|false> - è®¾ç½®æ˜¯å¦å…è®¸ç›—ç‰ˆç©å®¶åŠ å…¥"
    allowcracked_status: "&a/ximultilogin allowcracked - æŸ¥çœ‹å½“å‰è®¾ç½®"
    reload: "&a/ximultilogin reload - é‡æ–°åŠ è½½é…ç½®æ–‡ä»¶"
    info: "&a/ximultilogin info - æ˜¾ç¤ºæ’ä»¶ä¿¡æ¯"
    footer: "&6============================="
  info:
    title: "&6===== XiMultiLogin æ’ä»¶ä¿¡æ¯ ====="
    version: "&aç‰ˆæœ¬: 2.0"
    author: "&aä½œè€…: XiNian-dada"
    description: "&aæè¿°: å¤šç™»å½•æ–¹å¼æ”¯æŒæ’ä»¶"
    command: "&aæŒ‡ä»¤: /ximultilogin help"
    footer: "&6==============================="
```

## ä½¿ç”¨æ•™ç¨‹

### ç©å®¶ç™»å½•æµç¨‹

1. **æ–°ç©å®¶ç™»å½•**
   - ç©å®¶å°è¯•åŠ å…¥æœåŠ¡å™¨
   - æ’ä»¶æŒ‰é…ç½®é¡ºåºå°è¯•ä¸åŒçš„è®¤è¯æ–¹å¼
   - ç¬¬ä¸€ä¸ªæˆåŠŸçš„è®¤è¯æ–¹å¼ä¼šè¢«è®°å½•åˆ°æ•°æ®åº“
   - ç©å®¶ç™»å½•æˆåŠŸï¼ŒUUID è¢«è®°å½•

2. **è€ç©å®¶ç™»å½•**
   - ç©å®¶å°è¯•åŠ å…¥æœåŠ¡å™¨
   - æ’ä»¶æŸ¥è¯¢æ•°æ®åº“ï¼Œè·å–è¯¥ç©å®¶çš„å†å²è®¤è¯æ–¹å¼
   - åªä½¿ç”¨è¯¥è®¤è¯æ–¹å¼è¿›è¡ŒéªŒè¯
   - å¦‚æœéªŒè¯æˆåŠŸï¼Œä½¿ç”¨å†å² UUIDï¼ˆUUID æ¥ç®¡ï¼‰
   - å¦‚æœéªŒè¯å¤±è´¥ï¼Œæ‹’ç»ç™»å½•

3. **ç›—ç‰ˆç©å®¶ç™»å½•**ï¼ˆéœ€è¦ `allow_cracked: true`ï¼‰
   - ç©å®¶å°è¯•åŠ å…¥æœåŠ¡å™¨
   - æ‰€æœ‰è®¤è¯æ–¹å¼éƒ½å¤±è´¥
   - æ’ä»¶åˆ›å»ºä¸´æ—¶èº«ä»½ï¼Œå…è®¸ç©å®¶åŠ å…¥
   - ä¸´æ—¶èº«ä»½ä¸ä¼šè¢«è®°å½•åˆ°æ•°æ®åº“

### ç®¡ç†å‘˜å‘½ä»¤

| å‘½ä»¤ | æè¿° | æƒé™ |
|------|------|------|
| `/ximultilogin setauth <ç©å®¶å> <è®¤è¯ç±»å‹>` | è®¾ç½®ç©å®¶çš„è®¤è¯æ–¹å¼ | `ximultilogin.admin` |
| `/ximultilogin getauth <ç©å®¶å>` | è·å–ç©å®¶çš„å½“å‰è®¤è¯æ–¹å¼ | `ximultilogin.admin` |
| `/ximultilogin allowcracked <true\|false>` | è®¾ç½®æ˜¯å¦å…è®¸ç›—ç‰ˆç©å®¶åŠ å…¥ | `ximultilogin.admin` |
| `/ximultilogin allowcracked` | æŸ¥çœ‹å½“å‰ç›—ç‰ˆç©å®¶è®¾ç½® | `ximultilogin.admin` |
| `/ximultilogin reload` | é‡æ–°åŠ è½½é…ç½®æ–‡ä»¶ | `ximultilogin.admin` |
| `/ximultilogin info` | æ˜¾ç¤ºæ’ä»¶ä¿¡æ¯ | `ximultilogin.admin` |
| `/ximultilogin help` | æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯ | æ—  |

**è®¤è¯ç±»å‹è¯´æ˜**ï¼š

- `MOJANG`ï¼šMojang å®˜æ–¹è®¤è¯
- `YGGDRASIL`ï¼šYggdrasil åè®®è®¤è¯ï¼ˆéœ€è¦æŒ‡å®šå…·ä½“çš„ Yggdrasil æœåŠ¡å™¨åç§°ï¼‰

**ç¤ºä¾‹**ï¼š

```
# è®¾ç½®ç©å®¶ "Steve" ä½¿ç”¨ Mojang è®¤è¯
/ximultilogin setauth Steve MOJANG

# è®¾ç½®ç©å®¶ "Alex" ä½¿ç”¨ LittleSkin è®¤è¯
/ximultilogin setauth Alex LittleSkin

# æŸ¥è¯¢ç©å®¶ "Steve" çš„è®¤è¯æ–¹å¼
/ximultilogin getauth Steve

# å…è®¸ç›—ç‰ˆç©å®¶åŠ å…¥
/ximultilogin allowcracked true

# é‡æ–°åŠ è½½é…ç½®
/ximultilogin reload
```

### PAPI å˜é‡æ”¯æŒ

å¦‚æœæœåŠ¡å™¨å®‰è£…äº† PlaceholderAPIï¼Œæ’ä»¶æä¾›ä»¥ä¸‹å˜é‡ï¼š

| å˜é‡ | æè¿° |
|------|------|
| `%ximultilogin_auth_provider%` | ç©å®¶çš„å½“å‰è®¤è¯æ–¹å¼ |
| `%ximultilogin_uuid%` | ç©å®¶çš„ UUID |

**ç¤ºä¾‹**ï¼š

```
# åœ¨èŠå¤©æ ¼å¼ä¸­ä½¿ç”¨
chat-format: "&a[%ximultilogin_auth_provider%] &f{player}: &f{message}"

# åœ¨è®¡åˆ†æ¿ä¸­ä½¿ç”¨
scoreboard:
  - "&aè®¤è¯æ–¹å¼: %ximultilogin_auth_provider%"
  - "&aUUID: %ximultilogin_uuid%"
```

### å¸¸è§ä½¿ç”¨åœºæ™¯

#### åœºæ™¯ 1ï¼šæœåŠ¡å™¨åŒæ—¶æ”¯æŒæ­£ç‰ˆå’Œç¬¬ä¸‰æ–¹è®¤è¯

```yaml
pipeline:
  - type: MOJANG
    enabled: true
  - type: YGGDRASIL
    name: "LittleSkin"
    api: "https://littleskin.cn/api/yggdrasil"
    enabled: true
```

æ–°ç©å®¶ä¼šå…ˆå°è¯• Mojang è®¤è¯ï¼Œå¤±è´¥åå°è¯• LittleSkin è®¤è¯ã€‚ä¸€æ—¦ä½¿ç”¨æŸç§æ–¹å¼ç™»å½•æˆåŠŸï¼Œåç»­ç™»å½•å¿…é¡»ä½¿ç”¨ç›¸åŒæ–¹å¼ã€‚

#### åœºæ™¯ 2ï¼šä»…æ”¯æŒç¬¬ä¸‰æ–¹è®¤è¯

```yaml
pipeline:
  - type: YGGDRASIL
    name: "HairuoSKY"
    api: "https://skin.hairuosky.cn/api/yggdrasil"
    enabled: true
```

æ‰€æœ‰ç©å®¶å¿…é¡»ä½¿ç”¨ HairuoSKY è®¤è¯ã€‚

#### åœºæ™¯ 3ï¼šå…è®¸ç›—ç‰ˆç©å®¶

```yaml
pipeline:
  - type: MOJANG
    enabled: true

allow_cracked: true
```

æ­£ç‰ˆç©å®¶ä½¿ç”¨ Mojang è®¤è¯ï¼Œç›—ç‰ˆç©å®¶å¯ä»¥ä¸è®¤è¯ç›´æ¥åŠ å…¥ï¼ˆä¸´æ—¶èº«ä»½ï¼‰ã€‚

#### åœºæ™¯ 4ï¼šç©å®¶è¿ç§»è®¤è¯æ–¹å¼

```
# ç©å®¶ "Steve" åŸæ¥ä½¿ç”¨ LittleSkin è®¤è¯
/ximultilogin getauth Steve
# è¾“å‡ºï¼šç©å®¶ Steve çš„å½“å‰è®¤è¯æ–¹å¼ï¼šLittleSkin

# ç©å®¶å¸Œæœ›è¿ç§»åˆ° Mojang è®¤è¯
/ximultilogin setauth Steve MOJANG
# è¾“å‡ºï¼šæˆåŠŸè®¾ç½®ç©å®¶ Steve çš„è®¤è¯æ–¹å¼ä¸º MOJANGï¼

# ç©å®¶ä¸‹æ¬¡ç™»å½•æ—¶ï¼Œä¼šä½¿ç”¨ Mojang è®¤è¯ï¼Œä½† UUID ä¿æŒä¸å˜
```

## å¼€å‘æŒ‡å—

### ç¯å¢ƒè¦æ±‚

- **Java ç‰ˆæœ¬**ï¼šJava 8 æˆ–æ›´é«˜ç‰ˆæœ¬
- **Maven ç‰ˆæœ¬**ï¼šMaven 3.6 æˆ–æ›´é«˜ç‰ˆæœ¬
- **Git**ï¼šç”¨äºç‰ˆæœ¬æ§åˆ¶

### æ„å»ºé¡¹ç›®

```bash
# å…‹éš†ä»“åº“
git clone https://github.com/XiNian-dada/XiMultiLogin.git
cd XiMultiLogin

# ç¼–è¯‘é¡¹ç›®ï¼ˆè·³è¿‡æµ‹è¯•ï¼‰
mvn package -DskipTests

# ç¼–è¯‘å¹¶è¿è¡Œæµ‹è¯•
mvn package

# ç”Ÿæˆçš„ JAR æ–‡ä»¶ä½äº target/XiMultiLogin-1.0.jar
```

### é¡¹ç›®ç»“æ„

```
XiMultiLogin/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main/java/com/leeinx/ximultilogin/
â”‚   â”‚   â”œâ”€â”€ XiMultiLogin.java              # ä¸»ç±»
â”‚   â”‚   â”œâ”€â”€ auth/                           # è®¤è¯ç›¸å…³
â”‚   â”‚   â”‚   â”œâ”€â”€ AuthProvider.java           # è®¤è¯æä¾›è€…æ¥å£
â”‚   â”‚   â”‚   â”œâ”€â”€ XiSessionService.java       # ä¼šè¯æœåŠ¡ï¼ˆæ ¸å¿ƒï¼‰
â”‚   â”‚   â”‚   â””â”€â”€ providers/                  # è®¤è¯æä¾›è€…å®ç°
â”‚   â”‚   â”‚       â”œâ”€â”€ MojangAuthProvider.java # Mojang è®¤è¯
â”‚   â”‚   â”‚       â””â”€â”€ YggdrasilAuthProvider.java # Yggdrasil è®¤è¯
â”‚   â”‚   â”œâ”€â”€ command/                        # å‘½ä»¤ç›¸å…³
â”‚   â”‚   â”‚   â”œâ”€â”€ XiCommandExecutor.java      # å‘½ä»¤æ‰§è¡Œå™¨
â”‚   â”‚   â”‚   â””â”€â”€ XiTabCompleter.java         # TAB è¡¥å…¨
â”‚   â”‚   â”œâ”€â”€ config/                         # é…ç½®ç›¸å…³
â”‚   â”‚   â”‚   â”œâ”€â”€ ConfigManager.java          # é…ç½®ç®¡ç†å™¨
â”‚   â”‚   â”‚   â””â”€â”€ MessageManager.java         # æ¶ˆæ¯ç®¡ç†å™¨
â”‚   â”‚   â”œâ”€â”€ database/                       # æ•°æ®åº“ç›¸å…³
â”‚   â”‚   â”‚   â”œâ”€â”€ DatabaseManager.java        # æ•°æ®åº“æ¥å£
â”‚   â”‚   â”‚   â”œâ”€â”€ DatabaseFactory.java        # æ•°æ®åº“å·¥å‚
â”‚   â”‚   â”‚   â”œâ”€â”€ SQLiteDatabaseManager.java   # SQLite å®ç°
â”‚   â”‚   â”‚   â””â”€â”€ MySQLDatabaseManager.java   # MySQL å®ç°
â”‚   â”‚   â”œâ”€â”€ guard/                          # å®‰å…¨ç›¸å…³
â”‚   â”‚   â”‚   â””â”€â”€ IdentityGuard.java          # èº«ä»½å®ˆæŠ¤
â”‚   â”‚   â”œâ”€â”€ injector/                       # æ³¨å…¥ç›¸å…³
â”‚   â”‚   â”‚   â””â”€â”€ XiInjector.java             # æ³¨å…¥å™¨
â”‚   â”‚   â”œâ”€â”€ papi/                           # PAPI ç›¸å…³
â”‚   â”‚   â”‚   â””â”€â”€ XiPlaceholderExpansion.java # PAPI å˜é‡
â”‚   â”‚   â””â”€â”€ reflection/                     # åå°„ç›¸å…³
â”‚   â”‚       â””â”€â”€ XiReflection.java          # åå°„å·¥å…·
â”‚   â”œâ”€â”€ main/resources/
â”‚   â”‚   â”œâ”€â”€ config.yml                      # é…ç½®æ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ messages.yml                    # æ¶ˆæ¯é…ç½®
â”‚   â”‚   â””â”€â”€ plugin.yml                      # æ’ä»¶é…ç½®
â”‚   â””â”€â”€ test/                               # æµ‹è¯•ä»£ç 
â”œâ”€â”€ pom.xml                                 # Maven é…ç½®
â””â”€â”€ README.md                               # æœ¬æ–‡æ¡£
```

### æ‰©å±•è®¤è¯æ–¹å¼

å¦‚æœéœ€è¦æ·»åŠ æ–°çš„è®¤è¯æ–¹å¼ï¼ŒæŒ‰ç…§ä»¥ä¸‹æ­¥éª¤ï¼š

1. **å®ç° AuthProvider æ¥å£**

```java
package com.leeinx.ximultilogin.auth.providers;

import com.leeinx.ximultilogin.auth.AuthProvider;
import java.util.logging.Logger;

public class CustomAuthProvider implements AuthProvider {
    private final String name;
    private final String apiUrl;
    private final Logger logger;

    public CustomAuthProvider(String name, String apiUrl, Logger logger) {
        this.name = name;
        this.apiUrl = apiUrl;
        this.logger = logger;
    }

    @Override
    public String getName() {
        return name;
    }

    @Override
    public Object authenticate(String username, String serverId) {
        // å®ç°è®¤è¯é€»è¾‘
        // è¿”å› GameProfile å¯¹è±¡æˆ– null
        return null;
    }
}
```

2. **åœ¨ ConfigManager ä¸­æ³¨å†Œæ–°çš„è®¤è¯ç±»å‹**

3. **åœ¨ XiSessionService ä¸­æ·»åŠ å¯¹æ–°è®¤è¯ç±»å‹çš„æ”¯æŒ**

4. **æ›´æ–°é…ç½®æ–‡ä»¶æ ¼å¼**

### è´¡çŒ®æŒ‡å—

æ¬¢è¿æäº¤ Issue å’Œ Pull Request æ¥å¸®åŠ©æ”¹è¿›è¿™ä¸ªé¡¹ç›®ï¼

1. Fork ä»“åº“
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯ (`git checkout -b feature/amazing-feature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some amazing feature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/amazing-feature`)
5. æ‰“å¼€ Pull Request

## å¸¸è§é—®é¢˜

### Q1: ä¸ºä»€ä¹ˆç©å®¶ç™»å½•å¤±è´¥ï¼Ÿ

**A**: æ£€æŸ¥ä»¥ä¸‹å‡ ç‚¹ï¼š

1. ç¡®è®¤é…ç½®æ–‡ä»¶ä¸­çš„è®¤è¯æ–¹å¼å·²å¯ç”¨ï¼ˆ`enabled: true`ï¼‰
2. æŸ¥çœ‹æ§åˆ¶å°æ—¥å¿—ï¼Œç¡®è®¤è®¤è¯è¿‡ç¨‹
3. å¦‚æœæ˜¯è€ç©å®¶ï¼Œç¡®è®¤ä½¿ç”¨çš„æ˜¯æ­£ç¡®çš„è®¤è¯æ–¹å¼
4. æ£€æŸ¥ç½‘ç»œè¿æ¥ï¼Œç¡®ä¿èƒ½è®¿é—®è®¤è¯æœåŠ¡å™¨

### Q2: å¦‚ä½•åˆ‡æ¢ç©å®¶çš„è®¤è¯æ–¹å¼ï¼Ÿ

**A**: ä½¿ç”¨å‘½ä»¤ `/ximultilogin setauth <ç©å®¶å> <è®¤è¯ç±»å‹>`ã€‚

æ³¨æ„ï¼šåˆ‡æ¢è®¤è¯æ–¹å¼åï¼Œç©å®¶çš„ UUID ä¸ä¼šæ”¹å˜ï¼ˆUUID æ¥ç®¡ç³»ç»Ÿï¼‰ã€‚

### Q3: ä¸ºä»€ä¹ˆç›—ç‰ˆç©å®¶æ— æ³•åŠ å…¥ï¼Ÿ

**A**: æ£€æŸ¥é…ç½®æ–‡ä»¶ä¸­çš„ `allow_cracked` è®¾ç½®ï¼Œç¡®ä¿ä¸º `true`ã€‚

### Q4: å¦‚ä½•æ”¯æŒå¤šä¸ª Yggdrasil æœåŠ¡å™¨ï¼Ÿ

**A**: åœ¨é…ç½®æ–‡ä»¶ä¸­æ·»åŠ å¤šä¸ª YGGDRASIL ç±»å‹çš„é…ç½®ï¼Œæ¯ä¸ªé…ç½®ä½¿ç”¨ä¸åŒçš„ `name`ï¼š

```yaml
pipeline:
  - type: YGGDRASIL
    name: "LittleSkin"
    api: "https://littleskin.cn/api/yggdrasil"
    enabled: true
  - type: YGGDRASIL
    name: "HairuoSKY"
    api: "https://skin.hairuosky.cn/api/yggdrasil"
    enabled: true
```

### Q5: æ•°æ®åº“æ•°æ®ä¼šä¸¢å¤±å—ï¼Ÿ

**A**: ä¸ä¼šã€‚ç©å®¶çš„èº«ä»½ä¿¡æ¯ï¼ˆåç§°ã€UUIDã€è®¤è¯æ–¹å¼ï¼‰ä¼šæŒä¹…åŒ–å­˜å‚¨åœ¨æ•°æ®åº“ä¸­ï¼Œé‡å¯æœåŠ¡å™¨ä¸ä¼šä¸¢å¤±ã€‚

### Q6: æ”¯æŒå“ªäº› Minecraft ç‰ˆæœ¬ï¼Ÿ

**A**: æ”¯æŒ Minecraft 1.16.5 - 1.21+ï¼Œç‰¹åˆ«ä¼˜åŒ–äº† 1.20.2+ ç‰ˆæœ¬ï¼ˆè§£å†³äº† Record ä¸å¯å˜æ€§é—®é¢˜ï¼‰ã€‚

### Q7: å¦‚ä½•æŸ¥çœ‹ç©å®¶çš„è®¤è¯æ–¹å¼ï¼Ÿ

**A**: ä½¿ç”¨å‘½ä»¤ `/ximultilogin getauth <ç©å®¶å>`ï¼Œæˆ–ä½¿ç”¨ PAPI å˜é‡ `%ximultilogin_auth_provider%`ã€‚

### Q8: æ’ä»¶ä¼šå½±å“æœåŠ¡å™¨æ€§èƒ½å—ï¼Ÿ

**A**: ä¸ä¼šã€‚æ’ä»¶ä½¿ç”¨ä¼˜åŒ–çš„è®¤è¯æµç¨‹å’Œæ•°æ®åº“æ“ä½œï¼Œå¯¹æœåŠ¡å™¨æ€§èƒ½å½±å“æå°ã€‚æ•°æ®åº“æ“ä½œä½¿ç”¨ HikariCP è¿æ¥æ± ï¼Œè¿›ä¸€æ­¥ä¼˜åŒ–æ€§èƒ½ã€‚

## ç‰ˆæœ¬ä¿¡æ¯

### å½“å‰ç‰ˆæœ¬
- **ç‰ˆæœ¬å·**ï¼š2.0

### ç‰ˆæœ¬å†å²
- **v2.0**ï¼šå®‰å…¨å¢å¼ºç‰ˆæœ¬
  - å®ç°æ·±åº¦é˜²å¾¡æœºåˆ¶ï¼ŒåŒé‡é˜»å¡ç¡®ä¿å®‰å…¨æ€§
  - ä¼˜åŒ–ä¸´æ—¶UUIDç”Ÿæˆé€»è¾‘ï¼Œä½¿ç”¨çœŸå®UUIDæ¶ˆé™¤LuckPermsè­¦å‘Š
  - å¢å¼ºçº¿ç¨‹å®‰å…¨è®¾è®¡ï¼Œä½¿ç”¨ConcurrentHashMapå¤„ç†å¹¶å‘ç™»å½•
  - æ·»åŠ è¯¦ç»†çš„å®‰å…¨å®¡è®¡æ—¥å¿—ï¼Œæé«˜å¯è§‚æµ‹æ€§
  - æ”¹è¿›è®¤è¯å¤±è´¥å¤„ç†ï¼Œæ˜¾ç¤ºè‡ªå®šä¹‰é”™è¯¯æ¶ˆæ¯è€Œéç³»ç»Ÿé»˜è®¤æ¶ˆæ¯
  - ä¼˜åŒ–äº‹ä»¶ç›‘å¬å™¨ä¼˜å…ˆçº§ï¼Œç¡®ä¿å®‰å…¨æ£€æŸ¥ä¼˜å…ˆæ‰§è¡Œ
  - å®Œå–„èµ„æºæ¸…ç†æœºåˆ¶ï¼Œé˜²æ­¢å†…å­˜æ³„æ¼

- **v1.0**ï¼šåˆå§‹ç‰ˆæœ¬
  - æ”¯æŒ Mojang å’Œ Yggdrasil è®¤è¯
  - SQLite å’Œ MySQL æ•°æ®åº“æ”¯æŒ
  - èº«ä»½é”å®šæœºåˆ¶
  - UUID æ¥ç®¡ç³»ç»Ÿ
  - ä¸¥æ ¼è®¤è¯æ¨¡å¼
  - å‘½ä»¤ç³»ç»Ÿ
  - PAPI å˜é‡æ”¯æŒ
  - æ¶ˆæ¯é…ç½®ç³»ç»Ÿ
  - ç›—ç‰ˆç©å®¶æ”¯æŒ
  - å¤šç‰ˆæœ¬å…¼å®¹ï¼ˆ1.16.5 - 1.21+ï¼‰
  - ç‰¹åˆ«ä¼˜åŒ– 1.20.2+ï¼ˆRecord æ”¯æŒï¼‰

## è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ - è¯¦æƒ…è¯·å‚é˜… LICENSE æ–‡ä»¶

## è”ç³»æ–¹å¼

- **ä½œè€…** XiNian-dada
- **é¡¹ç›®åœ°å€**ï¼šhttps://github.com/XiNian-dada/XiMultiLogin
- **é—®é¢˜åé¦ˆ**ï¼šhttps://github.com/XiNian-dada/XiMultiLogin/issues

---

**äº«å—ä½¿ç”¨ XiMultiLoginï¼** ğŸ‰

## English

XiMultiLogin is a multi-authentication plugin designed for Minecraft Bukkit/Spigot/Paper servers. It aims to solve the problem of the community lacking alternatives after MultiLogin discontinued support for the Bukkit platform.

## Background

### Why do we need XiMultiLogin?

MultiLogin is an excellent Minecraft multi-authentication plugin, but due to the development team's decision to stop supporting the Bukkit platform, many servers using Bukkit/Spigot/Paper lost the opportunity to use MultiLogin. XiMultiLogin emerged to fill this gap.

### Design Goals

- **High Performance**: Optimized authentication process, minimizing impact on server performance
- **High Configurability**: Flexible configuration system to meet different server needs
- **Multi-Authentication Support**: Support for Mojang official authentication and multiple Yggdrasil protocol authentications
- **Security and Reliability**: Strict identity locking mechanism to prevent identity theft
- **Easy to Use**: Simple configuration and command system to lower the usage threshold

## Core Features

### Multi-Authentication Support
- **Mojang Official Authentication**: Standard Minecraft account login
- **Yggdrasil Protocol Authentication**: Support for third-party skin sites like LittleSkin
- **Extensible Architecture**: Easy to add new authentication providers

### Security Features
- **Identity Locking Mechanism**: Prevent security issues of "same name different UUID"
- **Strict Authentication Mode**: Once a player logs in using a certain authentication method, subsequent logins must use the same method
- **UUID Takeover System**: Ensure UUID consistency when players switch between different authentication methods
- **Database Persistence**: Player identity information is not lost after server restart

### Management Features
- **Command System**: Complete management commands, support setting and querying player authentication methods
- **PAPI Variable Support**: Integration with PlaceholderAPI, displaying player authentication status
- **Message Configuration System**: Customizable all prompt messages
- **Cracked Player Support**: Optional whether to allow players who fail authentication to join

### Technical Features
- **Multi-Version Compatibility**: Support Minecraft 1.16.5 - 1.21+, specially optimized for 1.20.2+ (stability pending testing)
- **Dynamic Proxy Mechanism**: Solve ClassLoader isolation issues
- **Record Reconstruction Support**: Handle immutability of Java Record
- **Reflection Tools**: Cross-version reflection operations, adapt to different NMS class structures
- **Database Support**: SQLite (default) and MySQL, using HikariCP connection pool

## Working Principle

### Technical Architecture

XiMultiLogin implements multi-authentication support through the following core components:

#### 1. Injection Mechanism (XiInjector)

When the plugin starts, it injects the custom `XiSessionService` into the Minecraft server's verification process through reflection:

```
Server startup â†’ XiInjector initialization â†’ Inject XiSessionService â†’ Replace default SessionService
```

**Technical Challenges and Solutions**:

- **ClassLoader Isolation**: Different class loaders for plugins and servers cause type mismatch when operating directly
  - Solution: Use dynamic proxy to create cross-ClassLoader bridge objects

- **Java Record Immutability**: 1.20.2+ versions use Record to store configuration, which cannot be directly modified
  - Solution: Use reflection to read field values and rebuild Record objects

- **Method Signature Changes**: Method signatures may differ between versions
  - Solution: Use loose reflection matching and intelligent parameter adaptation

#### 2. Authentication Process (XiSessionService)

When a player attempts to join the server, the authentication process is as follows:

```
Player login â†’ hasJoinedServer call â†’ Check database â†’ 
  â”œâ”€ Has record â†’ Only use specified authentication method â†’ Success/Failure
  â””â”€ No record â†’ Traverse all authentication methods â†’ Record if successful â†’ Reject if failed
```

**Strict Authentication Mode**:

- If there is a player's authentication record in the database, only use the specified authentication method
- If authentication fails, directly reject login, do not try other methods
- This prevents identity theft: even if someone knows the password of another authentication method, they cannot log in

**UUID Takeover System**:

- When a player logs in using a new authentication method, the system checks if there is already a UUID record for that player
- If there is, use the historical UUID to ensure player identity consistency
- This solves the problem of data loss caused by UUID changes after switching authentication methods

#### 3. Authentication Providers (AuthProvider)

The plugin uses a provider pattern to support multiple authentication methods:

- **MojangAuthProvider**: Call Mojang official authentication API
- **YggdrasilAuthProvider**: Call Yggdrasil protocol API (supports LittleSkin, HairuoSKY, etc.)

Each provider implements the `authenticate()` method, returning the player's GameProfile or null.

#### 4. Identity Guard (IdentityGuard)

`IdentityGuard` is responsible for managing player identity information:

- Store the mapping relationship between player name, UUID and authentication method
- Prevent security issues of "same name different UUID"
- Provide UUID takeover functionality to ensure identity consistency

#### 5. Database Management (DatabaseManager)

Supports two databases:

- **SQLite**: Default, automatically creates `ximultilogin.db` file, suitable for small servers
- **MySQL**: Need manual configuration, suitable for large servers, provides better concurrency performance

Use HikariCP connection pool to optimize database connections.

### Data Flow Chart

```
Player login request
    â†“
XiSessionService.hasJoinedServer()
    â†“
Query database
    â†“
Has record?
    â”œâ”€ Yes â†’ Only use specified authentication method
    â”‚        â†“
    â”‚     Authentication successful?
    â”‚        â”œâ”€ Yes â†’ UUID takeover â†’ Return GameProfile
    â”‚        â””â”€ No â†’ Reject login
    â”‚
    â””â”€ No â†’ Traverse all authentication methods
             â†“
          Authentication successful?
             â”œâ”€ Yes â†’ Record authentication method and UUID â†’ Return GameProfile
             â””â”€ No â†’ Allow cracked?
                     â”œâ”€ Yes â†’ Create temporary identity â†’ Return GameProfile
                     â””â”€ No â†’ Reject login
```

## Installation Method

### System Requirements

- **Java Version**: Java 8 or higher
- **Server Type**: Bukkit/Spigot/Paper 1.16.5 - 1.21+
- **Dependency Plugins**: PlaceholderAPI (optional, for PAPI variable support)

### Installation Steps

1. **Download the plugin**
   - Download the latest version of `XiMultiLogin-x.x.jar` from GitHub Releases
   - Or compile the project yourself (see Development Guide)

2. **Install to server**
   - Put the JAR file into the server's `plugins` directory
   - Restart the server

3. **First startup**
   - The plugin will automatically create configuration files and database
   - SQLite database is used by default, no additional configuration required
   - Check the console log to ensure the plugin loads normally

## Configuration Instructions

After the plugin starts, it will generate the following files in the `plugins/XiMultiLogin` directory:

- `config.yml`: Main configuration file
- `messages.yml`: Message configuration file
- `ximultilogin.db`: SQLite database file (if using SQLite)

### Main Configuration File (config.yml)

```yaml
# XiMultiLogin configuration file
# Authentication chain order: try from top to bottom
pipeline:
  # Mojang official authentication
  - type: MOJANG
    enabled: true
  
  # Yggdrasil protocol authentication (LittleSkin)
  - type: YGGDRASIL
    name: "LittleSkin"
    api: "https://littleskin.cn/api/yggdrasil"
    enabled: true
  
  # Yggdrasil protocol authentication (HairuoSKY)
  - type: YGGDRASIL
    name: "HairuoSKY"
    api: "https://skin.hairuosky.cn/api/yggdrasil"
    enabled: true

# Database configuration
database:
  # Database type: SQLite (default) or MySQL
  type: "SQLite"
  
  # MySQL configuration (only effective when type is MySQL)
  mysql:
    host: "localhost"
    port: 3306
    database: "ximultilogin"
    username: "root"
    password: "password"

# Cracked player settings
# Whether to allow players who fail any authentication to join (default: false)
# Not recommended to enable, otherwise security issues may occur
allow_cracked: false

# Debug settings
# Whether to enable debug mode (default: false)
# When enabled, detailed log information will be displayed, including authentication process and error details
debug: false
```

#### Configuration Item Details

**Authentication Chain Configuration (pipeline)**

- `type`: Authentication type, supports `MOJANG` or `YGGDRASIL`
- `enabled`: Whether to enable this authentication method
- `name`: Authentication provider name (only required for `YGGDRASIL` type, used to identify different Yggdrasil servers)
- `api`: Yggdrasil API address (only required for `YGGDRASIL` type)

**Database Configuration (database)**

- `type`: Database type, optional `SQLite` or `MySQL`
- `mysql`: MySQL database configuration (only effective when `type` is `MySQL`)
  - `host`: MySQL server address
  - `port`: MySQL port
  - `database`: Database name
  - `username`: Database username
  - `password`: Database password

**Cracked Player Settings (allow_cracked)**

- `true`: Allow players who fail any authentication to join (create temporary identity)
- `false`: Reject players who fail authentication (default)

**Debug Settings (debug)**

- `true`: Enable debug mode, display detailed log information
- `false`: Disable debug mode, display only key information (default)

### Message Configuration File (messages.yml)

```yaml
# XiMultiLogin message configuration file
# Support color codes, such as &c, &a, etc.
# Support variable replacement, such as {player}, {reason}, etc.

login:
  success: "&aLogin successful! Welcome back, {player}!"
  failed: "&cLogin failed: {reason}"
  name_taken: "&cLogin failed: This nickname has been used, please choose another nickname!"
  auth_changed: "&aAuthentication method has been changed to {provider}!"
  cracked: "&eLogin successful (cracked mode): Welcome, {player}!"

error:
  authentication: "&cAuthentication failed: Unable to verify your identity!"
  no_permission: "&cInsufficient permissions: You do not have permission to perform this operation!"
  invalid_args: "&cInvalid arguments: Please check the command arguments!"
  player_not_found: "&cError: Player {player} not found!"
  config_error: "&cConfiguration error: {reason}"
  database: "&cDatabase error: {reason}"

command:
  success: "&aOperation successful!"
  set_auth: "&aSuccessfully set player {player}'s authentication method to {auth}!"
  get_auth: "&aPlayer {player}'s current authentication method: {auth}"
  set_allow_cracked: "&aSuccessfully set allow cracked players to join: {value}"
  get_allow_cracked: "&aCurrent setting for allowing cracked players to join: {value}"
  reloaded: "&aConfiguration has been reloaded!"
  messages_reloaded: "&aMessage configuration has been reloaded!"

system:
  enabled: "&aXiMultiLogin plugin has been enabled!"
  disabled: "&cXiMultiLogin plugin has been disabled!"
  messages_loaded: "&aMessage configuration loaded successfully!"
  messages_reload: "&aMessage configuration has been reloaded!"

other:
  unknown_command: "&cUnknown command: Please use /ximultilogin help to view help!"
  help: "&aUse /ximultilogin help to view command help!"
  help_menu:
    title: "&6===== XiMultiLogin Command Help ====="
    setauth: "&a/ximultilogin setauth <player> <auth type> - Set player's authentication method"
    getauth: "&a/ximultilogin getauth <player> - Get player's current authentication method"
    allowcracked: "&a/ximultilogin allowcracked <true|false> - Set whether to allow cracked players to join"
    allowcracked_status: "&a/ximultilogin allowcracked - View current setting"
    reload: "&a/ximultilogin reload - Reload configuration files"
    info: "&a/ximultilogin info - Display plugin information"
    footer: "&6============================="
  info:
    title: "&6===== XiMultiLogin Plugin Info ====="
    version: "&aVersion: 2.0"
    author: "&aAuthor: XiNian-dada"
    description: "&aDescription: Multi-login method support plugin"
    command: "&aCommand: /ximultilogin help"
    footer: "&6==============================="
```

## Usage Tutorial

### Player Login Process

1. **New player login**
   - Player tries to join the server
   - Plugin tries different authentication methods in configuration order
   - The first successful authentication method will be recorded to the database
   - Player logs in successfully, UUID is recorded

2. **Old player login**
   - Player tries to join the server
   - Plugin queries the database, gets the player's historical authentication method
   - Only use that authentication method for verification
   - If verification is successful, use historical UUID (UUID takeover)
   - If verification fails, reject login

3. **Cracked player login** (requires `allow_cracked: true`)
   - Player tries to join the server
   - All authentication methods fail
   - Plugin creates temporary identity, allows player to join
   - Temporary identity will not be recorded to the database

### Admin Commands

| Command | Description | Permission |
|---------|-------------|------------|
| `/ximultilogin setauth <player> <auth type>` | Set player's authentication method | `ximultilogin.admin` |
| `/ximultilogin getauth <player>` | Get player's current authentication method | `ximultilogin.admin` |
| `/ximultilogin allowcracked <true\|false>` | Set whether to allow cracked players to join | `ximultilogin.admin` |
| `/ximultilogin allowcracked` | View current cracked player setting | `ximultilogin.admin` |
| `/ximultilogin reload` | Reload configuration files | `ximultilogin.admin` |
| `/ximultilogin info` | Display plugin information | `ximultilogin.admin` |
| `/ximultilogin help` | Display help information | None |

**Authentication Type Description**:

- `MOJANG`: Mojang official authentication
- `YGGDRASIL`: Yggdrasil protocol authentication (need to specify specific Yggdrasil server name)

**Examples**:

```
# Set player "Steve" to use Mojang authentication
/ximultilogin setauth Steve MOJANG

# Set player "Alex" to use LittleSkin authentication
/ximultilogin setauth Alex LittleSkin

# Query player "Steve"'s authentication method
/ximultilogin getauth Steve

# Allow cracked players to join
/ximultilogin allowcracked true

# Reload configuration
/ximultilogin reload
```

### PAPI Variable Support

If the server has PlaceholderAPI installed, the plugin provides the following variables:

| Variable | Description |
|----------|-------------|
| `%ximultilogin_auth_provider%` | Player's current authentication method |
| `%ximultilogin_uuid%` | Player's UUID |

**Examples**:

```
# Use in chat format
chat-format: "&a[%ximultilogin_auth_provider%] &f{player}: &f{message}"

# Use in scoreboard
scoreboard:
  - "&aAuth method: %ximultilogin_auth_provider%"
  - "&aUUID: %ximultilogin_uuid%"
```

### Common Usage Scenarios

#### Scenario 1: Server supports both official and third-party authentication

```yaml
pipeline:
  - type: MOJANG
    enabled: true
  - type: YGGDRASIL
    name: "LittleSkin"
    api: "https://littleskin.cn/api/yggdrasil"
    enabled: true
```

New players will first try Mojang authentication, then LittleSkin authentication if it fails. Once successfully logged in with a certain method, subsequent logins must use the same method.

#### Scenario 2: Only support third-party authentication

```yaml
pipeline:
  - type: YGGDRASIL
    name: "HairuoSKY"
    api: "https://skin.hairuosky.cn/api/yggdrasil"
    enabled: true
```

All players must use HairuoSKY authentication.

#### Scenario 3: Allow cracked players

```yaml
pipeline:
  - type: MOJANG
    enabled: true

allow_cracked: true
```

Official players use Mojang authentication, cracked players can join without authentication (temporary identity).

#### Scenario 4: Player migration authentication method

```
# Player "Steve" originally used LittleSkin authentication
/ximultilogin getauth Steve
# Output: Player Steve's current authentication method: LittleSkin

# Player wants to migrate to Mojang authentication
/ximultilogin setauth Steve MOJANG
# Output: Successfully set player Steve's authentication method to MOJANG!

# Player will use Mojang authentication next time, but UUID remains unchanged
```

## Development Guide

### Environment Requirements

- **Java Version**: Java 8 or higher
- **Maven Version**: Maven 3.6 or higher
- **Git**: For version control

### Build Project

```bash
# Clone repository
git clone https://github.com/XiNian-dada/XiMultiLogin.git
cd XiMultiLogin

# Compile project (skip tests)
mvn package -DskipTests

# Compile and run tests
mvn package

# Generated JAR file is located at target/XiMultiLogin-2.0.jar
```

### Project Structure

```
XiMultiLogin/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main/java/com/leeinx/ximultilogin/
â”‚   â”‚   â”œâ”€â”€ XiMultiLogin.java              # Main class
â”‚   â”‚   â”œâ”€â”€ auth/                           # Authentication related
â”‚   â”‚   â”‚   â”œâ”€â”€ AuthProvider.java           # Authentication provider interface
â”‚   â”‚   â”‚   â”œâ”€â”€ XiSessionService.java       # Session service (core)
â”‚   â”‚   â”‚   â””â”€â”€ providers/                  # Authentication provider implementations
â”‚   â”‚   â”‚       â”œâ”€â”€ MojangAuthProvider.java # Mojang authentication
â”‚   â”‚   â”‚       â””â”€â”€ YggdrasilAuthProvider.java # Yggdrasil authentication
â”‚   â”‚   â”œâ”€â”€ command/                        # Command related
â”‚   â”‚   â”‚   â”œâ”€â”€ XiCommandExecutor.java      # Command executor
â”‚   â”‚   â”‚   â””â”€â”€ XiTabCompleter.java         # TAB completer
â”‚   â”‚   â”œâ”€â”€ config/                         # Configuration related
â”‚   â”‚   â”‚   â”œâ”€â”€ ConfigManager.java          # Configuration manager
â”‚   â”‚   â”‚   â””â”€â”€ MessageManager.java         # Message manager
â”‚   â”‚   â”œâ”€â”€ database/                       # Database related
â”‚   â”‚   â”‚   â”œâ”€â”€ DatabaseManager.java        # Database interface
â”‚   â”‚   â”‚   â”œâ”€â”€ DatabaseFactory.java        # Database factory
â”‚   â”‚   â”‚   â”œâ”€â”€ SQLiteDatabaseManager.java   # SQLite implementation
â”‚   â”‚   â”‚   â””â”€â”€ MySQLDatabaseManager.java   # MySQL implementation
â”‚   â”‚   â”œâ”€â”€ guard/                          # Security related
â”‚   â”‚   â”‚   â””â”€â”€ IdentityGuard.java          # Identity guard
â”‚   â”‚   â”œâ”€â”€ injector/                       # Injection related
â”‚   â”‚   â”‚   â””â”€â”€ XiInjector.java             # Injector
â”‚   â”‚   â”œâ”€â”€ papi/                           # PAPI related
â”‚   â”‚   â”‚   â””â”€â”€ XiPlaceholderExpansion.java # PAPI variables
â”‚   â”‚   â””â”€â”€ reflection/                     # Reflection related
â”‚   â”‚       â””â”€â”€ XiReflection.java          # Reflection tools
â”‚   â”œâ”€â”€ main/resources/
â”‚   â”‚   â”œâ”€â”€ config.yml                      # Configuration file
â”‚   â”‚   â”œâ”€â”€ messages.yml                    # Message configuration
â”‚   â”‚   â””â”€â”€ plugin.yml                      # Plugin configuration
â”‚   â””â”€â”€ test/                               # Test code
â”œâ”€â”€ pom.xml                                 # Maven configuration
â””â”€â”€ README.md                               # This document
```

### Extend Authentication Method

If you need to add a new authentication method, follow these steps:

1. **Implement AuthProvider interface**

```java
package com.leeinx.ximultilogin.auth.providers;

import com.leeinx.ximultilogin.auth.AuthProvider;
import java.util.logging.Logger;

public class CustomAuthProvider implements AuthProvider {
    private final String name;
    private final String apiUrl;
    private final Logger logger;

    public CustomAuthProvider(String name, String apiUrl, Logger logger) {
        this.name = name;
        this.apiUrl = apiUrl;
        this.logger = logger;
    }

    @Override
    public String getName() {
        return name;
    }

    @Override
    public Object authenticate(String username, String serverId) {
        // Implement authentication logic
        // Return GameProfile object or null
        return null;
    }
}
```

2. **Register new authentication type in ConfigManager**

3. **Add support for new authentication type in XiSessionService**

4. **Update configuration file format**

### Contribution Guide

Welcome to submit Issues and Pull Requests to help improve this project!

1. Fork the repository
2. Create a feature branch (`git checkout -b feature/amazing-feature`)
3. Commit changes (`git commit -m 'Add some amazing feature'`)
4. Push to the branch (`git push origin feature/amazing-feature`)
5. Open a Pull Request

## Frequently Asked Questions

### Q1: Why does player login fail?

**A**: Check the following:

1. Confirm the authentication method in the configuration file is enabled (`enabled: true`)
2. Check the console log to confirm the authentication process
3. If it's an old player, confirm using the correct authentication method
4. Check network connection to ensure access to authentication server

### Q2: How to switch player's authentication method?

**A**: Use the command `/ximultilogin setauth <player> <auth type>`.

Note: After switching authentication methods, the player's UUID will not change (UUID takeover system).

### Q3: Why can't cracked players join?

**A**: Check the `allow_cracked` setting in the configuration file, ensure it is `true`.

### Q4: How to support multiple Yggdrasil servers?

**A**: Add multiple YGGDRASIL type configurations in the configuration file, each with a different `name`:

```yaml
pipeline:
  - type: YGGDRASIL
    name: "LittleSkin"
    api: "https://littleskin.cn/api/yggdrasil"
    enabled: true
  - type: YGGDRASIL
    name: "HairuoSKY"
    api: "https://skin.hairuosky.cn/api/yggdrasil"
    enabled: true
```

### Q5: Will database data be lost?

**A**: No. Player identity information (name, UUID, authentication method) is persistently stored in the database and will not be lost after server restart.

### Q6: Which Minecraft versions are supported?

**A**: Supports Minecraft 1.16.5 - 1.21+, specially optimized for 1.20.2+ version (solved Record immutability issue).

### Q7: How to view player's authentication method?

**A**: Use the command `/ximultilogin getauth <player>`, or use PAPI variable `%ximultilogin_auth_provider%`.

### Q8: Will the plugin affect server performance?

**A**: No. The plugin uses optimized authentication process and database operations, with minimal impact on server performance. Database operations use HikariCP connection pool for further performance optimization.

## Version Information

### Current Version
- **Version Number**: 2.0

### Version History
- **v2.0**: Security enhanced version
  - Implemented depth defense mechanism, double blocking to ensure security
  - Optimized temporary UUID generation logic, use real UUID to eliminate LuckPerms warnings
  - Enhanced thread-safe design, use ConcurrentHashMap to handle concurrent logins
  - Added detailed security audit logs, improved observability
  - Improved authentication failure handling, display custom error messages instead of system default messages
  - Optimized event listener priority, ensure security checks are executed first
  - Improved resource cleanup mechanism, prevent memory leaks

- **v1.0**: Initial version
  - Support Mojang and Yggdrasil authentication
  - SQLite and MySQL database support
  - Identity locking mechanism
  - UUID takeover system
  - Strict authentication mode
  - Command system
  - PAPI variable support
  - Message configuration system
  - Cracked player support
  - Multi-version compatibility (1.16.5 - 1.21+)
  - Specially optimized for 1.20.2+ (Record support)

## License

This project is licensed under the MIT License - see the LICENSE file for details

## Contact

- **Author**: XiNian-dada
- **Project Address**: https://github.com/XiNian-dada/XiMultiLogin
- **Issue Feedback**: https://github.com/XiNian-dada/XiMultiLogin/issues

---

**Enjoy using XiMultiLogin!** ğŸ‰
